<!DOCTYPE html><html lang="ko"><head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>공지사항</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="/css/style.css"/>
  <style>
    #noticeTable th,#noticeTable td{font-size:13px}
    .title-cell .title{font-weight:700}
    .title-cell .meta{color:var(--gray-500);font-size:12px;margin-top:2px}
  </style>
</head>
<body class="bg-page">
<div id="header"></div>
<main class="py-4">
  <div class="container-1200 d-flex gap-24">
    <div id="sidebar"></div>
    <section class="flex-1">
      <div class="fw-700 fs-5 mb-12">공지사항</div>

      <!-- 검색 -->
      <div class="card-white p-20 mb-16">
        <form id="filterForm" class="row g-3">
          <div class="col-12 col-md-5">
            <input id="q" type="text" class="form-control" placeholder="제목 / 본문 검색">
          </div>
          <div class="col-6 col-md-3">
            <select id="category" class="form-select">
              <option value="">분류(전체)</option>
              <option value="학사">학사</option>
              <option value="장학">장학</option>
              <option value="행사">행사</option>
            </select>
          </div>
          <div class="col-6 col-md-2">
            <input id="from" type="date" class="form-control">
          </div>
          <div class="col-6 col-md-2">
            <button class="btn btn-navy rounded-pill w-100">검색</button>
          </div>
        </form>
      </div>

      <!-- 목록 -->
      <div class="card-white p-20">
        <div class="d-flex justify-content-between align-items-center mb-12">
          <div class="fw-700">공지 목록</div>
          <div class="xsmall text-gray-500"><span id="resultCount">0</span>건</div>
        </div>

        <div class="table-wrap">
          <table class="table align-middle" id="noticeTable">
            <thead>
            <tr>
              <th style="width:90px">번호</th>
              <th>제목</th>
              <th style="width:120px">분류</th>
              <th style="width:140px">작성자</th>
              <th style="width:120px">게시일</th>
              <!-- 상태 표시 없음 -->
            </tr>
            </thead>
            <tbody id="noticeTbody"></tbody>
          </table>
        </div>

        <div id="emptyState" class="xsmall text-gray-500 mt-2" style="display:none;">표시할 공지가 없습니다.</div>

        <!-- 페이징 -->
        <nav class="mt-3">
          <ul id="pagination" class="pagination justify-content-center mb-0"></ul>
        </nav>
      </div>
    </section>
  </div>
</main>
<div id="footer"></div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // 데모 데이터(서버연동 시 교체) — status: PUBLISHED | SCHEDULED | HIDDEN | DRAFT
  const MOCK = [
    { id: 301, title:"2학기 수강신청 안내", category:"학사", author:"학사팀", content:"...", status:"PUBLISHED", publishAt:"2025-08-21" },
    { id: 300, title:"장학금 신청 일정",   category:"장학", author:"장학팀", content:"...", status:"PUBLISHED", publishAt:"2025-08-15" },
    { id: 299, title:"가을 축제 개최",     category:"행사", author:"총학생회", content:"...", status:"SCHEDULED", publishAt:"2025-10-01" },
    { id: 298, title:"테스트(숨김)",       category:"학사", author:"관리자", content:"...", status:"HIDDEN",    publishAt:"2025-08-10" },
    { id: 297, title:"임시 초안",          category:"학사", author:"관리자", content:"...", status:"DRAFT",     publishAt:"2025-08-05" }
  ];
  const st = { q:"", category:"", from:"", page:1, size:8, all:[...MOCK], filtered:[] };

  function isVisibleToUser(n){
    const today = new Date().toISOString().slice(0,10);
    if (n.status==="HIDDEN"||n.status==="DRAFT") return false;
    if (n.status==="SCHEDULED" && n.publishAt>today) return false;
    return true;
  }

  function applyFilters(e){
    if(e) e.preventDefault();
    st.q = $("#q").val().trim().toLowerCase();
    st.category = $("#category").val();
    st.from = $("#from").val();

    st.filtered = st.all
            .filter(isVisibleToUser)
            .filter(n=>{
              const hitQ = !st.q || n.title.toLowerCase().includes(st.q) || (n.content||"").toLowerCase().includes(st.q);
              const hitC = !st.category || n.category===st.category;
              const hitD = !st.from || n.publishAt>=st.from;
              return hitQ && hitC && hitD;
            })
            .sort((a,b)=> b.id-a.id);
    st.page=1;
    render();
  }

  function paginate(list){ const s=(st.page-1)*st.size; return list.slice(s,s+st.size); }

  function render(){
    const $tb=$("#noticeTbody").empty();
    const total=st.filtered.length;
    const pageTotal=Math.max(1,Math.ceil(total/st.size));
    st.page=Math.min(st.page,pageTotal);
    const pageList=paginate(st.filtered);
    $("#resultCount").text(total);
    $("#emptyState").toggle(total===0);

    pageList.forEach((n,idx)=>{
      const no = total-((st.page-1)*st.size+idx);
      $tb.append(`
        <tr>
          <td>${no}</td>
          <td class="title-cell">
            <a href="notice-view.html?id=${n.id}" class="title">${n.title}</a>
            <div class="meta">게시일 ${n.publishAt}</div>
          </td>
          <td>${n.category}</td>
          <td>${n.author||'-'}</td>
          <td>${n.publishAt||'-'}</td>
        </tr>
      `);
    });
    renderPagination(pageTotal);
  }

  function renderPagination(pageTotal){
    const $p=$("#pagination").empty();
    const item=(label,page,disabled=false,active=false)=>$(`
      <li class="page-item ${disabled?'disabled':''} ${active?'active':''}">
        <a class="page-link" href="#" data-page="${page}">${label}</a>
      </li>
    `);
    $p.append(item("&laquo;&laquo;",1,st.page===1));
    const w=2; let s=Math.max(1,st.page-w), e=Math.min(pageTotal,st.page+w);
    if(s>1){ $p.append(item("1",1,false,st.page===1)); if(s>2)$p.append(`<li class="page-item disabled"><span class="page-link">...</span></li>`); }
    for(let i=s;i<=e;i++) $p.append(item(String(i),i,false,st.page===i));
    if(e<pageTotal){ if(e<pageTotal-1)$p.append(`<li class="page-item disabled"><span class="page-link">...</span></li>`); $p.append(item(String(pageTotal),pageTotal,false,st.page===pageTotal)); }
    $p.append(item("&raquo;&raquo;",pageTotal,st.page===pageTotal));
    $p.find("a.page-link").on("click",function(ev){ ev.preventDefault(); const p=Number($(this).data("page")); if(!p||p===st.page)return; st.page=p; render(); });
  }

  $(function(){ $("#filterForm").on("submit", applyFilters); applyFilters(); });
</script>
<script src="script/common-ui.js"></script><script src="script/app.js"></script>
<!-- ✅ 공통 include: static/mapper/... -->
<script>
  $(function () {
    $("#header").load("/mapper/header.html");
    $("#sidebar").load("/mapper/sidebar.html");
    $("#footer").load("/mapper/footer.html");
  });
</script>
</body></html>
